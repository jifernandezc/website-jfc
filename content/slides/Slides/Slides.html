<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Manejo de Datos en R</title>
    <meta charset="utf-8" />
    <meta name="author" content="Javier Fernández" />
    <meta name="date" content="2021-06-01" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="custom.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Manejo de Datos en R
## <code>dplyr</code> y <code>data.table</code>
### <a href="https://jfernandez.netlify.app">Javier Fernández</a>
### <a href="https://cepr.uai.cl">Centro de Economía y Política Regional</a>
### 06/01/2021

---


background-image: url(https://cidetic.unlu.edu.ar/wordpress/wp-content/uploads/2018/08/Rlogo.png)



---

# Hoy veremos...

- Motivación
- Data Wrangling en R:
  - `dplyr`
  - `data.table`
  - Ejemplo con datos de juguete
- Aplicación con datos "reales"

---
class: inverse, center, middle

# Empezamos!

---
background-image: url(https://es.r4ds.hadley.nz/diagrams_w_text_as_path/es/data-science.svg)
background-size: 100% 100%

# Proceso Recursivo en Ciencia de Datos

---
# Data Wrangling?

- Es el proceso de seleccionar, limpiar, unificar y consolidar los datos que se usaran para determinado análisis
--

- En esta tarea se invierta entre un 50% y 80%&lt;sup&gt;1&lt;/sup&gt; del tiempo de desarrollo de un proyecto de datos

.footnote[
[1] Ver en [Principles of Data Wrangling](https://www.bankingtech.com/files/2017/10/Trifacta_Principles-of-Data-Wrangling.pdf)]

---
# Data Wrangling en R

- Actualmente en R existen tres "sets" de herramientas para realizar trabajo con datos:
  - `base`
  - `dplyr`(`tydiverse`)
  - `data.table`
--

- ¿Por qué aprender los dos y no solamente quedarse con el **mejor**?


---
class: inverse, center, middle

# Como se cree que es

---
background-image:url(imagenes/vd.png)
background-size: contain

---
class: inverse, center, middle

# Como es realmente

---
background-image:url(imagenes/vd2.png)
background-size: contain

.footnote[
Basado en exposición de [Hadley Wickham](https://www.youtube.com/watch?v=vYwXMnC03I4&amp;ab_channel=MangoSolutions)]
---
background-image:url(imagenes/dplyr.png)
background-size: 15% 20%
background-position: center bottom
# `dplyr` y la gramática de los datos 

--

- Forma parte del set de herramientas de tydiverse 

--

- Se destaca por su **readability**

--

- Es uno de los paquetes más utilizados por los usuarios R
- Es el paquete más utilizado para manipular datos por los usuarios de R

---
background-image:url(imagenes/dplyr.png)
background-size: 15% 20%
background-position: center bottom
# `dplyr` y la gramática de los datos 

Se estructura en base a un conjunto de cinco verbos:

- `mutate()`: Agrega una nueva variable que es función de otra existente

--

- `select()`: Selecciona variables basado en sus nombres


--

- `filter()`: Selecciona observaciones basadas en su valor

--


- `summarise()`: Reduce múltiples valores a un solo resumen dada una función

--

- `arrange()`: Ordena la base de datos

--

Además, se puede combinar con `group_by()` que nos permite realizar operaciones por grupo.


---
# `magrittR` y la revolución de los pipes

.left[![:scale 40%](imagenes/rev1.jpg)]

--

.right[![](imagenes/rev2.jpeg)]

--

.upimage[![](imagenes/mug.jpg)]

---
background-image:url(imagenes/magrittr.jpg)
background-size: 30% 30%
background-position: center bottom

# `magrittR`

Usualmente en R las funciones se escriben al igual que en las matemáticas:

`f(x)`

--

Eso significa que estoy aplicando la función `f()` al argumento `x`. Los pipes nos permiten escribir esto de la siguiente manera:

`x %&gt;% f()` 

--

Esto en un principio pareciera no tener mucha utilidad, pero en el caso de funciones complejas con múltiples argumentos es más fácil entender

`x %&gt;% f(y,z) %&gt;% g(a,b) %&gt;% h(e)`

--

que

`h(g(f(x,y,z),a,b),e)`

--

.bottomright[![:scale 70%](imagenes/pipe.jpg)]

---
class: inverse, center, middle

# Un pequeño ejemplo

---
# Datos


Usaremos los siguientes datos para los ejemplos a continuación:

--


```r
library(dplyr)
DT::datatable(
  head(starwars[,1:5], 10),
  fillContainer = FALSE, options = list(pageLength = 5)
)
```

<div id="htmlwidget-3c0a515b8c1914cad73b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-3c0a515b8c1914cad73b">{"x":{"filter":"none","fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10"],["Luke Skywalker","C-3PO","R2-D2","Darth Vader","Leia Organa","Owen Lars","Beru Whitesun lars","R5-D4","Biggs Darklighter","Obi-Wan Kenobi"],[172,167,96,202,150,178,165,97,183,182],[77,75,32,136,49,120,75,32,84,77],["blond",null,null,"none","brown","brown, grey","brown",null,"black","auburn, white"],["fair","gold","white, blue","white","light","light","light","white, red","light","fair"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>name<\/th>\n      <th>height<\/th>\n      <th>mass<\/th>\n      <th>hair_color<\/th>\n      <th>skin_color<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>

---


.left-column[
### `select()`
]

.right-column[

```r
starwars&lt;-starwars %&gt;% 
  select(name,height,sex,species)
starwars
```

```
## # A tibble: 87 x 4
##    name               height sex    species
##    &lt;chr&gt;               &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;  
##  1 Luke Skywalker        172 male   Human  
##  2 C-3PO                 167 none   Droid  
##  3 R2-D2                  96 none   Droid  
##  4 Darth Vader           202 male   Human  
##  5 Leia Organa           150 female Human  
##  6 Owen Lars             178 male   Human  
##  7 Beru Whitesun lars    165 female Human  
##  8 R5-D4                  97 none   Droid  
##  9 Biggs Darklighter     183 male   Human  
## 10 Obi-Wan Kenobi        182 male   Human  
## # ... with 77 more rows
```
]

---
.left-column[
### `select()`
### `mutate()`
]

.right-column[

```r
starwars %&gt;% 
  mutate(hmts=height/100)
```

```
## # A tibble: 87 x 5
##    name               height sex    species  hmts
##    &lt;chr&gt;               &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;   &lt;dbl&gt;
##  1 Luke Skywalker        172 male   Human    1.72
##  2 C-3PO                 167 none   Droid    1.67
##  3 R2-D2                  96 none   Droid    0.96
##  4 Darth Vader           202 male   Human    2.02
##  5 Leia Organa           150 female Human    1.5 
##  6 Owen Lars             178 male   Human    1.78
##  7 Beru Whitesun lars    165 female Human    1.65
##  8 R5-D4                  97 none   Droid    0.97
##  9 Biggs Darklighter     183 male   Human    1.83
## 10 Obi-Wan Kenobi        182 male   Human    1.82
## # ... with 77 more rows
```
]

---
.left-column[
### `select()`
### `mutate()`
### `filter()`
]

.right-column[

```r
starwars %&gt;% 
  filter(species=="Human")
```

```
## # A tibble: 35 x 4
##    name               height sex    species
##    &lt;chr&gt;               &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;  
##  1 Luke Skywalker        172 male   Human  
##  2 Darth Vader           202 male   Human  
##  3 Leia Organa           150 female Human  
##  4 Owen Lars             178 male   Human  
##  5 Beru Whitesun lars    165 female Human  
##  6 Biggs Darklighter     183 male   Human  
##  7 Obi-Wan Kenobi        182 male   Human  
##  8 Anakin Skywalker      188 male   Human  
##  9 Wilhuff Tarkin        180 male   Human  
## 10 Han Solo              180 male   Human  
## # ... with 25 more rows
```
]

---

.left-column[
### `select()`
### `mutate()`
### `filter()`
### `arrange()`
]

.right-column[


```r
starwars %&gt;% 
* arrange(desc(height))
```

```
## # A tibble: 87 x 4
##    name         height sex    species 
##    &lt;chr&gt;         &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;   
##  1 Yarael Poof     264 male   Quermian
##  2 Tarfful         234 male   Wookiee 
##  3 Lama Su         229 male   Kaminoan
##  4 Chewbacca       228 male   Wookiee 
##  5 Roos Tarpals    224 male   Gungan  
##  6 Grievous        216 male   Kaleesh 
##  7 Taun We         213 female Kaminoan
##  8 Rugor Nass      206 male   Gungan  
##  9 Tion Medon      206 male   Pau'an  
## 10 Darth Vader     202 male   Human   
## # ... with 77 more rows
```

]

--


.bottomright[![](imagenes/Yarael.png)]

---

.left-column[
### `select()`
### `mutate()`
### `filter()`
### `arrange()`
### `summarise()`
]

.right-column[

```r
starwars %&gt;% 
* summarise(mean(height))
```

```
## # A tibble: 1 x 1
##   `mean(height)`
##            &lt;dbl&gt;
## 1             NA
```

]

--

.right-column[

```r
starwars %&gt;% 
* summarise(mean(height,na.rm = TRUE))
```

```
## # A tibble: 1 x 1
##   `mean(height, na.rm = TRUE)`
##                          &lt;dbl&gt;
## 1                         174.
```

]


---
.left-column[
### `select()`
### `mutate()`
### `filter()`
### `arrange()`
### `summarise()`
### + `group_by()`
]

.right-column[

```r
starwars %&gt;%
  group_by(species) %&gt;%
  summarise(mean=mean(height),n=n())
```

```
## # A tibble: 38 x 3
##    species    mean     n
##    &lt;chr&gt;     &lt;dbl&gt; &lt;int&gt;
##  1 Aleena      79      1
##  2 Besalisk   198      1
##  3 Cerean     198      1
##  4 Chagrian   196      1
##  5 Clawdite   168      1
##  6 Droid       NA      6
##  7 Dug        112      1
##  8 Ewok        88      1
##  9 Geonosian  183      1
## 10 Gungan     209.     3
## # ... with 28 more rows
```

]
---

.left-column[
### `select()`
### `mutate()`
### `filter()`
### `arrange()`
### `summarise()`
### + `group_by()`
]

.right-column[

```r
starwars %&gt;%
  group_by(species) %&gt;%
  summarise(mean=mean(height,na.rm=T),n=n()) %&gt;%
  arrange(desc(n))
```

```
## # A tibble: 38 x 3
##    species   mean     n
##    &lt;chr&gt;    &lt;dbl&gt; &lt;int&gt;
##  1 Human     177.    35
##  2 Droid     131.     6
##  3 &lt;NA&gt;      181.     4
##  4 Gungan    209.     3
##  5 Kaminoan  221      2
##  6 Mirialan  168      2
##  7 Twi'lek   179      2
##  8 Wookiee   231      2
##  9 Zabrak    173      2
## 10 Aleena     79      1
## # ... with 28 more rows
```

]

---
background-image:url(imagenes/DT.png)
background-size: 30% 30%
background-position: center bottom

# `data.table` y la simplicidad de la eficiencia

- No tiene dependencias de otros paquetes fuera de los recursos base

--

- Se destaca por su **eficiencia**
  - Velocidad de procesamiento (Tiempo)
  - Utilización de memoria

--

- Es uno de los paquetes más utilizados por los usuarios R
- Excelente retrocompatibilidad

---
# `data.table`

Este paquete tiene la siguiente forma general (sintaxis):

--

&lt;br&gt;&lt;br&gt;

 .center[.big[`ObjetoDT[   i   ,    j  ,  by]`]]
  
  
&lt;br&gt;&lt;br&gt;

--

"Tomamos `ObjetoDT`, seleccionamos/reordenamos las filas `i`, entonces calculamos `j`, agrupados por `by`"
---

class: inverse, center, middle

# El mismo ejemplo, pero ahora DTeable

---



Estas son algunas funciones básicas:

.left-column[
### .little[`data.table()`]  
]

.right-column[


```r
library(data.table)
starwars&lt;-as.data.table(starwars)
class(starwars)
```

```
## [1] "data.table" "data.frame"
```

]

---

Estas son algunas funciones básicas:

.left-column[
### .little[`data.table()`]
### .little[`DT[ ,.(x,y)]`]
]

.right-column[


```r
starwars&lt;-starwars[,.(name,height,sex,species)]
starwars
```

```
##                      name height            sex        species
##  1:        Luke Skywalker    172           male          Human
##  2:                 C-3PO    167           none          Droid
##  3:                 R2-D2     96           none          Droid
##  4:           Darth Vader    202           male          Human
##  5:           Leia Organa    150         female          Human
##  6:             Owen Lars    178           male          Human
##  7:    Beru Whitesun lars    165         female          Human
##  8:                 R5-D4     97           none          Droid
##  9:     Biggs Darklighter    183           male          Human
## 10:        Obi-Wan Kenobi    182           male          Human
## 11:      Anakin Skywalker    188           male          Human
## 12:        Wilhuff Tarkin    180           male          Human
## 13:             Chewbacca    228           male        Wookiee
## 14:              Han Solo    180           male          Human
## 15:                Greedo    173           male         Rodian
## 16: Jabba Desilijic Tiure    175 hermaphroditic           Hutt
## 17:        Wedge Antilles    170           male          Human
## 18:      Jek Tono Porkins    180           male          Human
## 19:                  Yoda     66           male Yoda's species
## 20:             Palpatine    170           male          Human
## 21:             Boba Fett    183           male          Human
## 22:                 IG-88    200           none          Droid
## 23:                 Bossk    190           male     Trandoshan
## 24:      Lando Calrissian    177           male          Human
## 25:                 Lobot    175           male          Human
## 26:                Ackbar    180           male   Mon Calamari
## 27:            Mon Mothma    150         female          Human
## 28:          Arvel Crynyd     NA           male          Human
## 29: Wicket Systri Warrick     88           male           Ewok
## 30:             Nien Nunb    160           male      Sullustan
## 31:          Qui-Gon Jinn    193           male          Human
## 32:           Nute Gunray    191           male      Neimodian
## 33:         Finis Valorum    170           male          Human
## 34:         Jar Jar Binks    196           male         Gungan
## 35:          Roos Tarpals    224           male         Gungan
## 36:            Rugor Nass    206           male         Gungan
## 37:              Ric Olié    183           &lt;NA&gt;           &lt;NA&gt;
## 38:                 Watto    137           male      Toydarian
## 39:               Sebulba    112           male            Dug
## 40:         Quarsh Panaka    183           &lt;NA&gt;           &lt;NA&gt;
## 41:        Shmi Skywalker    163         female          Human
## 42:            Darth Maul    175           male         Zabrak
## 43:           Bib Fortuna    180           male        Twi'lek
## 44:           Ayla Secura    178         female        Twi'lek
## 45:              Dud Bolt     94           male     Vulptereen
## 46:               Gasgano    122           male          Xexto
## 47:        Ben Quadinaros    163           male          Toong
## 48:            Mace Windu    188           male          Human
## 49:          Ki-Adi-Mundi    198           male         Cerean
## 50:             Kit Fisto    196           male       Nautolan
## 51:             Eeth Koth    171           male         Zabrak
## 52:            Adi Gallia    184         female     Tholothian
## 53:           Saesee Tiin    188           male       Iktotchi
## 54:           Yarael Poof    264           male       Quermian
## 55:              Plo Koon    188           male        Kel Dor
## 56:            Mas Amedda    196           male       Chagrian
## 57:          Gregar Typho    185           male          Human
## 58:                 Cordé    157         female          Human
## 59:           Cliegg Lars    183           male          Human
## 60:     Poggle the Lesser    183           male      Geonosian
## 61:       Luminara Unduli    170         female       Mirialan
## 62:         Barriss Offee    166         female       Mirialan
## 63:                 Dormé    165         female          Human
## 64:                 Dooku    193           male          Human
## 65:   Bail Prestor Organa    191           male          Human
## 66:            Jango Fett    183           male          Human
## 67:            Zam Wesell    168         female       Clawdite
## 68:       Dexter Jettster    198           male       Besalisk
## 69:               Lama Su    229           male       Kaminoan
## 70:               Taun We    213         female       Kaminoan
## 71:            Jocasta Nu    167         female          Human
## 72:         Ratts Tyerell     79           male         Aleena
## 73:                R4-P17     96           none          Droid
## 74:            Wat Tambor    193           male        Skakoan
## 75:              San Hill    191           male           Muun
## 76:              Shaak Ti    178         female        Togruta
## 77:              Grievous    216           male        Kaleesh
## 78:               Tarfful    234           male        Wookiee
## 79:       Raymus Antilles    188           male          Human
## 80:             Sly Moore    178           &lt;NA&gt;           &lt;NA&gt;
## 81:            Tion Medon    206           male         Pau'an
## 82:                  Finn     NA           male          Human
## 83:                   Rey     NA         female          Human
## 84:           Poe Dameron     NA           male          Human
## 85:                   BB8     NA           none          Droid
## 86:        Captain Phasma     NA           &lt;NA&gt;           &lt;NA&gt;
## 87:         Padmé Amidala    165         female          Human
##                      name height            sex        species
```

]

---

Estas son algunas funciones básicas:

.left-column[
### .little[`data.table()`]
### .little[`DT[ ,.(x,y)]`]
### .little[`DT[ ,y:=f(x)]`]
]

.right-column[

```r
starwars[,hmts:=height/100]
starwars
```

```
##                      name height            sex        species hmts
##  1:        Luke Skywalker    172           male          Human 1.72
##  2:                 C-3PO    167           none          Droid 1.67
##  3:                 R2-D2     96           none          Droid 0.96
##  4:           Darth Vader    202           male          Human 2.02
##  5:           Leia Organa    150         female          Human 1.50
##  6:             Owen Lars    178           male          Human 1.78
##  7:    Beru Whitesun lars    165         female          Human 1.65
##  8:                 R5-D4     97           none          Droid 0.97
##  9:     Biggs Darklighter    183           male          Human 1.83
## 10:        Obi-Wan Kenobi    182           male          Human 1.82
## 11:      Anakin Skywalker    188           male          Human 1.88
## 12:        Wilhuff Tarkin    180           male          Human 1.80
## 13:             Chewbacca    228           male        Wookiee 2.28
## 14:              Han Solo    180           male          Human 1.80
## 15:                Greedo    173           male         Rodian 1.73
## 16: Jabba Desilijic Tiure    175 hermaphroditic           Hutt 1.75
## 17:        Wedge Antilles    170           male          Human 1.70
## 18:      Jek Tono Porkins    180           male          Human 1.80
## 19:                  Yoda     66           male Yoda's species 0.66
## 20:             Palpatine    170           male          Human 1.70
## 21:             Boba Fett    183           male          Human 1.83
## 22:                 IG-88    200           none          Droid 2.00
## 23:                 Bossk    190           male     Trandoshan 1.90
## 24:      Lando Calrissian    177           male          Human 1.77
## 25:                 Lobot    175           male          Human 1.75
## 26:                Ackbar    180           male   Mon Calamari 1.80
## 27:            Mon Mothma    150         female          Human 1.50
## 28:          Arvel Crynyd     NA           male          Human   NA
## 29: Wicket Systri Warrick     88           male           Ewok 0.88
## 30:             Nien Nunb    160           male      Sullustan 1.60
## 31:          Qui-Gon Jinn    193           male          Human 1.93
## 32:           Nute Gunray    191           male      Neimodian 1.91
## 33:         Finis Valorum    170           male          Human 1.70
## 34:         Jar Jar Binks    196           male         Gungan 1.96
## 35:          Roos Tarpals    224           male         Gungan 2.24
## 36:            Rugor Nass    206           male         Gungan 2.06
## 37:              Ric Olié    183           &lt;NA&gt;           &lt;NA&gt; 1.83
## 38:                 Watto    137           male      Toydarian 1.37
## 39:               Sebulba    112           male            Dug 1.12
## 40:         Quarsh Panaka    183           &lt;NA&gt;           &lt;NA&gt; 1.83
## 41:        Shmi Skywalker    163         female          Human 1.63
## 42:            Darth Maul    175           male         Zabrak 1.75
## 43:           Bib Fortuna    180           male        Twi'lek 1.80
## 44:           Ayla Secura    178         female        Twi'lek 1.78
## 45:              Dud Bolt     94           male     Vulptereen 0.94
## 46:               Gasgano    122           male          Xexto 1.22
## 47:        Ben Quadinaros    163           male          Toong 1.63
## 48:            Mace Windu    188           male          Human 1.88
## 49:          Ki-Adi-Mundi    198           male         Cerean 1.98
## 50:             Kit Fisto    196           male       Nautolan 1.96
## 51:             Eeth Koth    171           male         Zabrak 1.71
## 52:            Adi Gallia    184         female     Tholothian 1.84
## 53:           Saesee Tiin    188           male       Iktotchi 1.88
## 54:           Yarael Poof    264           male       Quermian 2.64
## 55:              Plo Koon    188           male        Kel Dor 1.88
## 56:            Mas Amedda    196           male       Chagrian 1.96
## 57:          Gregar Typho    185           male          Human 1.85
## 58:                 Cordé    157         female          Human 1.57
## 59:           Cliegg Lars    183           male          Human 1.83
## 60:     Poggle the Lesser    183           male      Geonosian 1.83
## 61:       Luminara Unduli    170         female       Mirialan 1.70
## 62:         Barriss Offee    166         female       Mirialan 1.66
## 63:                 Dormé    165         female          Human 1.65
## 64:                 Dooku    193           male          Human 1.93
## 65:   Bail Prestor Organa    191           male          Human 1.91
## 66:            Jango Fett    183           male          Human 1.83
## 67:            Zam Wesell    168         female       Clawdite 1.68
## 68:       Dexter Jettster    198           male       Besalisk 1.98
## 69:               Lama Su    229           male       Kaminoan 2.29
## 70:               Taun We    213         female       Kaminoan 2.13
## 71:            Jocasta Nu    167         female          Human 1.67
## 72:         Ratts Tyerell     79           male         Aleena 0.79
## 73:                R4-P17     96           none          Droid 0.96
## 74:            Wat Tambor    193           male        Skakoan 1.93
## 75:              San Hill    191           male           Muun 1.91
## 76:              Shaak Ti    178         female        Togruta 1.78
## 77:              Grievous    216           male        Kaleesh 2.16
## 78:               Tarfful    234           male        Wookiee 2.34
## 79:       Raymus Antilles    188           male          Human 1.88
## 80:             Sly Moore    178           &lt;NA&gt;           &lt;NA&gt; 1.78
## 81:            Tion Medon    206           male         Pau'an 2.06
## 82:                  Finn     NA           male          Human   NA
## 83:                   Rey     NA         female          Human   NA
## 84:           Poe Dameron     NA           male          Human   NA
## 85:                   BB8     NA           none          Droid   NA
## 86:        Captain Phasma     NA           &lt;NA&gt;           &lt;NA&gt;   NA
## 87:         Padmé Amidala    165         female          Human 1.65
##                      name height            sex        species hmts
```

]


---

Estas son algunas funciones básicas:

.left-column[
### .little[`data.table()`]
### .little[`DT[ ,.(x,y)]`]
### .little[`DT[ ,y:=f(x)]`]
### .little[`DT[x opr y]`]
]

.right-column[

```r
starwars[species=="Human"]
```

```
##                    name height    sex species hmts
##  1:      Luke Skywalker    172   male   Human 1.72
##  2:         Darth Vader    202   male   Human 2.02
##  3:         Leia Organa    150 female   Human 1.50
##  4:           Owen Lars    178   male   Human 1.78
##  5:  Beru Whitesun lars    165 female   Human 1.65
##  6:   Biggs Darklighter    183   male   Human 1.83
##  7:      Obi-Wan Kenobi    182   male   Human 1.82
##  8:    Anakin Skywalker    188   male   Human 1.88
##  9:      Wilhuff Tarkin    180   male   Human 1.80
## 10:            Han Solo    180   male   Human 1.80
## 11:      Wedge Antilles    170   male   Human 1.70
## 12:    Jek Tono Porkins    180   male   Human 1.80
## 13:           Palpatine    170   male   Human 1.70
## 14:           Boba Fett    183   male   Human 1.83
## 15:    Lando Calrissian    177   male   Human 1.77
## 16:               Lobot    175   male   Human 1.75
## 17:          Mon Mothma    150 female   Human 1.50
## 18:        Arvel Crynyd     NA   male   Human   NA
## 19:        Qui-Gon Jinn    193   male   Human 1.93
## 20:       Finis Valorum    170   male   Human 1.70
## 21:      Shmi Skywalker    163 female   Human 1.63
## 22:          Mace Windu    188   male   Human 1.88
## 23:        Gregar Typho    185   male   Human 1.85
## 24:               Cordé    157 female   Human 1.57
## 25:         Cliegg Lars    183   male   Human 1.83
## 26:               Dormé    165 female   Human 1.65
## 27:               Dooku    193   male   Human 1.93
## 28: Bail Prestor Organa    191   male   Human 1.91
## 29:          Jango Fett    183   male   Human 1.83
## 30:          Jocasta Nu    167 female   Human 1.67
## 31:     Raymus Antilles    188   male   Human 1.88
## 32:                Finn     NA   male   Human   NA
## 33:                 Rey     NA female   Human   NA
## 34:         Poe Dameron     NA   male   Human   NA
## 35:       Padmé Amidala    165 female   Human 1.65
##                    name height    sex species hmts
```

]


---

Estas son algunas funciones básicas:

.left-column[
### .little[`data.table()`]
### .little[`DT[ ,.(x,y)]`]
### .little[`DT[ ,y:=f(x)]`]
### .little[`DT[x opr y]`]
### .little[`DT[order(x)]`]
]

.right-column[

```r
starwars[order(height,decreasing = TRUE)]
```

```
##                      name height            sex        species hmts
##  1:           Yarael Poof    264           male       Quermian 2.64
##  2:               Tarfful    234           male        Wookiee 2.34
##  3:               Lama Su    229           male       Kaminoan 2.29
##  4:             Chewbacca    228           male        Wookiee 2.28
##  5:          Roos Tarpals    224           male         Gungan 2.24
##  6:              Grievous    216           male        Kaleesh 2.16
##  7:               Taun We    213         female       Kaminoan 2.13
##  8:            Rugor Nass    206           male         Gungan 2.06
##  9:            Tion Medon    206           male         Pau'an 2.06
## 10:           Darth Vader    202           male          Human 2.02
## 11:                 IG-88    200           none          Droid 2.00
## 12:          Ki-Adi-Mundi    198           male         Cerean 1.98
## 13:       Dexter Jettster    198           male       Besalisk 1.98
## 14:         Jar Jar Binks    196           male         Gungan 1.96
## 15:             Kit Fisto    196           male       Nautolan 1.96
## 16:            Mas Amedda    196           male       Chagrian 1.96
## 17:          Qui-Gon Jinn    193           male          Human 1.93
## 18:                 Dooku    193           male          Human 1.93
## 19:            Wat Tambor    193           male        Skakoan 1.93
## 20:           Nute Gunray    191           male      Neimodian 1.91
## 21:   Bail Prestor Organa    191           male          Human 1.91
## 22:              San Hill    191           male           Muun 1.91
## 23:                 Bossk    190           male     Trandoshan 1.90
## 24:      Anakin Skywalker    188           male          Human 1.88
## 25:            Mace Windu    188           male          Human 1.88
## 26:           Saesee Tiin    188           male       Iktotchi 1.88
## 27:              Plo Koon    188           male        Kel Dor 1.88
## 28:       Raymus Antilles    188           male          Human 1.88
## 29:          Gregar Typho    185           male          Human 1.85
## 30:            Adi Gallia    184         female     Tholothian 1.84
## 31:     Biggs Darklighter    183           male          Human 1.83
## 32:             Boba Fett    183           male          Human 1.83
## 33:              Ric Olié    183           &lt;NA&gt;           &lt;NA&gt; 1.83
## 34:         Quarsh Panaka    183           &lt;NA&gt;           &lt;NA&gt; 1.83
## 35:           Cliegg Lars    183           male          Human 1.83
## 36:     Poggle the Lesser    183           male      Geonosian 1.83
## 37:            Jango Fett    183           male          Human 1.83
## 38:        Obi-Wan Kenobi    182           male          Human 1.82
## 39:        Wilhuff Tarkin    180           male          Human 1.80
## 40:              Han Solo    180           male          Human 1.80
## 41:      Jek Tono Porkins    180           male          Human 1.80
## 42:                Ackbar    180           male   Mon Calamari 1.80
## 43:           Bib Fortuna    180           male        Twi'lek 1.80
## 44:             Owen Lars    178           male          Human 1.78
## 45:           Ayla Secura    178         female        Twi'lek 1.78
## 46:              Shaak Ti    178         female        Togruta 1.78
## 47:             Sly Moore    178           &lt;NA&gt;           &lt;NA&gt; 1.78
## 48:      Lando Calrissian    177           male          Human 1.77
## 49: Jabba Desilijic Tiure    175 hermaphroditic           Hutt 1.75
## 50:                 Lobot    175           male          Human 1.75
## 51:            Darth Maul    175           male         Zabrak 1.75
## 52:                Greedo    173           male         Rodian 1.73
## 53:        Luke Skywalker    172           male          Human 1.72
## 54:             Eeth Koth    171           male         Zabrak 1.71
## 55:        Wedge Antilles    170           male          Human 1.70
## 56:             Palpatine    170           male          Human 1.70
## 57:         Finis Valorum    170           male          Human 1.70
## 58:       Luminara Unduli    170         female       Mirialan 1.70
## 59:            Zam Wesell    168         female       Clawdite 1.68
## 60:                 C-3PO    167           none          Droid 1.67
## 61:            Jocasta Nu    167         female          Human 1.67
## 62:         Barriss Offee    166         female       Mirialan 1.66
## 63:    Beru Whitesun lars    165         female          Human 1.65
## 64:                 Dormé    165         female          Human 1.65
## 65:         Padmé Amidala    165         female          Human 1.65
## 66:        Shmi Skywalker    163         female          Human 1.63
## 67:        Ben Quadinaros    163           male          Toong 1.63
## 68:             Nien Nunb    160           male      Sullustan 1.60
## 69:                 Cordé    157         female          Human 1.57
## 70:           Leia Organa    150         female          Human 1.50
## 71:            Mon Mothma    150         female          Human 1.50
## 72:                 Watto    137           male      Toydarian 1.37
## 73:               Gasgano    122           male          Xexto 1.22
## 74:               Sebulba    112           male            Dug 1.12
## 75:                 R5-D4     97           none          Droid 0.97
## 76:                 R2-D2     96           none          Droid 0.96
## 77:                R4-P17     96           none          Droid 0.96
## 78:              Dud Bolt     94           male     Vulptereen 0.94
## 79: Wicket Systri Warrick     88           male           Ewok 0.88
## 80:         Ratts Tyerell     79           male         Aleena 0.79
## 81:                  Yoda     66           male Yoda's species 0.66
## 82:          Arvel Crynyd     NA           male          Human   NA
## 83:                  Finn     NA           male          Human   NA
## 84:                   Rey     NA         female          Human   NA
## 85:           Poe Dameron     NA           male          Human   NA
## 86:                   BB8     NA           none          Droid   NA
## 87:        Captain Phasma     NA           &lt;NA&gt;           &lt;NA&gt;   NA
##                      name height            sex        species hmts
```

]

---

Estas son algunas funciones básicas:

.left-column[
### .little[`data.table()`]
### .little[`DT[ ,.(x,y)]`]
### .little[`DT[ ,y:=f(x)]`]
### .little[`DT[x opr y]`]
### .little[`DT[order(x)]`]
### .little[`DT[,f(x),by=z]`]
]

.right-column[

```r
starwars[,.(mean=mean(height,na.rm = T),n=.N),by=species]
```

```
##            species     mean  n
##  1:          Human 176.6452 35
##  2:          Droid 131.2000  6
##  3:        Wookiee 231.0000  2
##  4:         Rodian 173.0000  1
##  5:           Hutt 175.0000  1
##  6: Yoda's species  66.0000  1
##  7:     Trandoshan 190.0000  1
##  8:   Mon Calamari 180.0000  1
##  9:           Ewok  88.0000  1
## 10:      Sullustan 160.0000  1
## 11:      Neimodian 191.0000  1
## 12:         Gungan 208.6667  3
## 13:           &lt;NA&gt; 181.3333  4
## 14:      Toydarian 137.0000  1
## 15:            Dug 112.0000  1
## 16:         Zabrak 173.0000  2
## 17:        Twi'lek 179.0000  2
## 18:     Vulptereen  94.0000  1
## 19:          Xexto 122.0000  1
## 20:          Toong 163.0000  1
## 21:         Cerean 198.0000  1
## 22:       Nautolan 196.0000  1
## 23:     Tholothian 184.0000  1
## 24:       Iktotchi 188.0000  1
## 25:       Quermian 264.0000  1
## 26:        Kel Dor 188.0000  1
## 27:       Chagrian 196.0000  1
## 28:      Geonosian 183.0000  1
## 29:       Mirialan 168.0000  2
## 30:       Clawdite 168.0000  1
## 31:       Besalisk 198.0000  1
## 32:       Kaminoan 221.0000  2
## 33:         Aleena  79.0000  1
## 34:        Skakoan 193.0000  1
## 35:           Muun 191.0000  1
## 36:        Togruta 178.0000  1
## 37:        Kaleesh 216.0000  1
## 38:         Pau'an 206.0000  1
##            species     mean  n
```

]


---

Estas son algunas funciones básicas:

.left-column[
### .little[`data.table()`]
### .little[`DT[ ,.(x,y)]`]
### .little[`DT[ ,y:=f(x)]`]
### .little[`DT[x opr y]`]
### .little[`DT[order(x)]`]
### .little[`DT[,f(x),by=z]`]
]

.right-column[

```r
starwars[,.(mean=mean(height,na.rm = T),n=.N),by=species][order(n,decreasing = T)]
```

```
##            species     mean  n
##  1:          Human 176.6452 35
##  2:          Droid 131.2000  6
##  3:           &lt;NA&gt; 181.3333  4
##  4:         Gungan 208.6667  3
##  5:        Wookiee 231.0000  2
##  6:         Zabrak 173.0000  2
##  7:        Twi'lek 179.0000  2
##  8:       Mirialan 168.0000  2
##  9:       Kaminoan 221.0000  2
## 10:         Rodian 173.0000  1
## 11:           Hutt 175.0000  1
## 12: Yoda's species  66.0000  1
## 13:     Trandoshan 190.0000  1
## 14:   Mon Calamari 180.0000  1
## 15:           Ewok  88.0000  1
## 16:      Sullustan 160.0000  1
## 17:      Neimodian 191.0000  1
## 18:      Toydarian 137.0000  1
## 19:            Dug 112.0000  1
## 20:     Vulptereen  94.0000  1
## 21:          Xexto 122.0000  1
## 22:          Toong 163.0000  1
## 23:         Cerean 198.0000  1
## 24:       Nautolan 196.0000  1
## 25:     Tholothian 184.0000  1
## 26:       Iktotchi 188.0000  1
## 27:       Quermian 264.0000  1
## 28:        Kel Dor 188.0000  1
## 29:       Chagrian 196.0000  1
## 30:      Geonosian 183.0000  1
## 31:       Clawdite 168.0000  1
## 32:       Besalisk 198.0000  1
## 33:         Aleena  79.0000  1
## 34:        Skakoan 193.0000  1
## 35:           Muun 191.0000  1
## 36:        Togruta 178.0000  1
## 37:        Kaleesh 216.0000  1
## 38:         Pau'an 206.0000  1
##            species     mean  n
```

]


---
class: inverse, middle, center

# Reflexiones finales

---

# `data.table` y `dplyr`

- Ambos tienen utilidades y fortalezas

--

- Mientras que `dplyr` aporta una mayor readability y simpleza a la hora de codificar,

--

- es innegable la eficiencia que provee `data.table`. De hecho, en algunos : [benchmarks](https://h2oai.github.io/db-benchmark/), tiene resultados competitivos fuera de R

--

- Si se está comenzando en R, puede que `dplyr` sea más intuitivo

--

- Si se va a trabajar con muchos datos, la alternativa más recomendable sería `data.table`

--

- [`dtplyr`](https://dtplyr.tidyverse.org/)

--
.right[![](https://media1.tenor.com/images/e5dab3697b62150a3b5b0f4b1a1f76f5/tenor.gif)]


---
class: inverse, middle, center

# Muchas gracias!

---

# Laboratorio

- Realizaremos un trabajo de datos aplicado con la base de datos del IVE (interrupción del embarazo) del DEIS 

--

- El objetivo es poner en práctica lo que aquí aprendimos

--

- A trabajar!

--
.center[![](https://media1.tenor.com/images/b276ea4cd677ee0957d063b4b200d5d2/tenor.gif?itemid=7921015)]
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script src="macros.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
